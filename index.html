<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Marketing da Nutri√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --base-font-size: 16px;
            --primary-color: #1A73E8;
            --primary-bg-color: #E8F0FE;
            --correct-color: #188038;
            --correct-bg-color: #E6F4EA;
            --incorrect-color: #D93025;
            --incorrect-bg-color: #FCE8E6;
            
            --light-theme-bg: #f1f3f4;
            --light-theme-card-bg: #ffffff;
            --light-theme-text: #202124;
            --light-theme-text-light: #5f6368;
            --light-theme-border: #dadce0;
            --light-theme-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 2px 6px 2px rgba(60,64,67,0.15);

            --dark-theme-bg: #202124;
            --dark-theme-card-bg: #2d2e30;
            --dark-theme-text: #e8eaed;
            --dark-theme-text-light: #bdc1c6;
            --dark-theme-border: #5f6368;
            --dark-theme-shadow: 0 1px 2px 0 rgba(0,0,0,0.3), 0 2px 6px 2px rgba(0,0,0,0.15);

            --neutral-bg-color: var(--light-theme-bg);
            --card-bg-color: var(--light-theme-card-bg);
            --text-color: var(--light-theme-text);
            --light-text-color: var(--light-theme-text-light);
            --border-color: var(--light-theme-border);
            --shadow-color: var(--light-theme-shadow);

            --sidebar-width: 300px;
        }

        body.dark-mode {
            --neutral-bg-color: var(--dark-theme-bg);
            --card-bg-color: var(--dark-theme-card-bg);
            --text-color: var(--dark-theme-text);
            --light-text-color: var(--dark-theme-text-light);
            --border-color: var(--dark-theme-border);
            --shadow-color: var(--dark-theme-shadow);
        }

        html {
            font-size: var(--base-font-size);
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background-color: var(--neutral-bg-color);
            margin: 0;
            display: flex;
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Sidebar --- */
        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background-color: transparent;
            position: fixed;
            top: 0;
            left: 0;
            padding: 0.75rem;
            box-sizing: border-box;
            transition: transform 0.3s ease-in-out;
            z-index: 2000;
        }

        .sidebar-content {
            background-color: var(--card-bg-color);
            width: 100%;
            height: 100%;
            border-radius: 1rem;
            box-shadow: var(--shadow-color);
            border: 1px solid var(--border-color);
            padding: 1.25rem;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s, border-color 0.3s;
        }

        #sidebar h2 {
            font-size: 1.5rem;
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: 1.25rem;
            padding-bottom: 0.625rem;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            transition: color 0.3s, border-color 0.3s;
        }

        #sidebar nav {
             overflow-y: auto;
             flex-grow: 1;
        }

        #sidebar nav ul { list-style: none; padding: 0; margin: 0; }
        #sidebar nav li a { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; text-decoration: none; color: var(--light-text-color); font-weight: 500; border-radius: 1.5rem; transition: background-color 0.2s ease, color 0.2s ease; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #sidebar nav li a:hover, #sidebar nav li a.active { background-color: var(--primary-bg-color); color: var(--primary-color); }
        #sidebar .submenu { padding-left: 1rem; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
        #sidebar .submenu.open { max-height: 30rem; }
        #sidebar .has-submenu > a { cursor: pointer; justify-content: space-between; }
        #sidebar .arrow { border: solid var(--light-text-color); border-width: 0 2px 2px 0; display: inline-block; padding: 3px; transform: rotate(45deg); transition: transform 0.3s, border-color 0.3s; }
        #sidebar .has-submenu > a:hover .arrow, #sidebar .has-submenu > a.active .arrow { border-color: var(--primary-color); }
        #sidebar .has-submenu.open > a .arrow { transform: rotate(-135deg); }

        /* --- Main Content & Header --- */
        .page-content { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); padding: 1.25rem; padding-top: 5rem; }
        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #header-container {
            width: calc(100% - var(--sidebar-width));
            background-color: rgba(241, 243, 244, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            padding: 0 1.5rem;
            box-sizing: border-box;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease-in-out;
        }
        body.dark-mode #header-container { background-color: rgba(45, 46, 48, 0.85); }
        
        .header-info-item { font-size: 1rem; font-weight: 500; padding: 0.5rem 1rem; border-radius: 1.5rem; transition: all 0.3s ease; }
        #score-counter { color: var(--correct-color); background-color: var(--correct-bg-color); }
        #incorrect-counter { color: var(--incorrect-color); background-color: var(--incorrect-bg-color); }
        #remaining-counter { color: var(--primary-color); background-color: var(--primary-bg-color); }
        #counters-wrapper { display: flex; gap: 0.75rem; }

        #font-controls { display: flex; align-items: center; position: absolute; left: 50%; transform: translateX(-50%); }
        #font-controls button { background: none; border: 1px solid var(--border-color); color: var(--light-text-color); font-weight: bold; width: 2.25rem; height: 2.25rem; border-radius: 50%; cursor: pointer; margin: 0 0.25rem; transition: background-color 0.2s, color 0.2s; }
        #font-controls button:hover { background-color: var(--primary-bg-color); color: var(--primary-color); }
        
        /* Theme Switcher */
        #theme-switcher { margin-right: 1rem; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 26px; }
        .slider:before { position: absolute; content: "‚òÄÔ∏è"; height: 18px; width: 18px; left: 5px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; text-align: center; font-size: 12px; line-height: 18px; color: #333; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(22px); content: "üåô"; }
        
        /* Progress Bar */
        #progress-container { position: absolute; bottom: -1px; left: 0; width: 100%; height: 4px; background-color: var(--border-color); transition: background-color 0.3s; }
        #progress-bar { width: 0%; height: 100%; background-color: var(--primary-color); transition: width 0.4s ease-out, background-color 0.3s; }

        /* Main Content Wrapper */
        .main-content-wrapper { width: 100%; max-width: 850px; margin: 0 auto; }
        h1 { text-align: center; color: var(--text-color); font-size: 2.5rem; font-weight: 700; margin-bottom: 0.625rem; }
        h3 { text-align: center; color: var(--light-text-color); font-size: 1.5rem; font-weight: 400; margin-top: 2.5rem; margin-bottom: 1.25rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.625rem; }
        .question-container { background: var(--card-bg-color); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 1px 2px rgba(0,0,0,.1), 0 2px 4px rgba(0,0,0,.1); border: 1px solid var(--border-color); transition: all 0.3s ease; }
        .question { font-weight: 500; font-size: 1.2rem; margin-bottom: 1.25rem; color: var(--text-color); line-height: 1.6; }
        .options label { display: flex; align-items: center; margin: 0.625rem 0; padding: 1rem; border: 1px solid var(--border-color); border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease; line-height: 1.5; }
        .options label:hover { background: var(--neutral-bg-color); border-color: #9aa0a6; }
        .options input { margin-right: 0.75rem; width: 1.125rem; height: 1.125rem; accent-color: var(--primary-color); }
        
        .correct { background: var(--correct-bg-color) !important; border-color: var(--correct-color) !important; color: var(--correct-color) !important; font-weight: 500; }
        .incorrect { background: var(--incorrect-bg-color) !important; border-color: var(--incorrect-color) !important; color: var(--incorrect-color) !important; font-weight: 500; }
        
        button.quiz-button { display: block; width: 220px; margin: 1.5rem auto 0; padding: 0.75rem 1.25rem; background: var(--primary-color); color: white; border: none; border-radius: 0.5rem; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease, transform 0.2s ease; }
        button.quiz-button:disabled { background: #bdbdbd; cursor: not-allowed; transform: none; }
        button.quiz-button:hover:not(:disabled) { background: var(--primary-hover-color); transform: translateY(-2px); }
        .feedback { margin-top: 1.25rem; font-size: 1rem; line-height: 1.7; background: var(--neutral-bg-color); padding: 1.25rem; border-radius: 0.5rem; border-left: 4px solid var(--border-color); animation: slideDown 0.4s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .feedback .correct-feedback::before { content: '‚úÖ '; }
        .feedback .incorrect-feedback::before { content: '‚ùå '; }
        #final-score { text-align: center; font-size: 1.5rem; color: var(--text-color); margin: 1.25rem 0; background: var(--card-bg-color); padding: 1.5rem; border-radius: 0.75rem; display: none; box-shadow: var(--shadow-color); }
        #final-score span { font-weight: 700; color: var(--primary-color); }
        #incorrect-review-list { margin-top: 1.5rem; text-align: left; font-size: 1rem; }
        #incorrect-review-list h4 { margin-bottom: 0.5rem; }
        #incorrect-review-list a { display: block; padding: 0.5rem; border-radius: 4px; text-decoration: none; color: var(--primary-color); }
        #incorrect-review-list a:hover { background-color: var(--primary-bg-color); }
        
        #menu-toggle, #reset-quiz-btn { display: none; }
        #reset-quiz-btn { margin-top: 1.5rem; }

        /* Modal for Resume Prompt */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background: var(--card-bg-color); padding: 2rem; border-radius: 1rem; text-align: center; box-shadow: var(--shadow-color); transform: scale(0.9); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-content h4 { margin-top: 0; }
        .modal-buttons { margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center; }

        /* --- Responsive Design --- */

        @media (max-width: 1024px) {
            #sidebar { transform: translateX(-100%); }
            #sidebar.open { transform: translateX(0); }
            .page-content { margin-left: 0; width: 100%; }
            #header-container { width: 100%; left: 0; }
            #menu-toggle { display: flex; justify-content: center; align-items: center; position: fixed; top: 10px; left: 10px; z-index: 2001; background: var(--card-bg-color); border: none; box-shadow: var(--shadow-color); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }
        }
        @media (max-width: 768px) {
            #counters-wrapper { display: none; }
            #font-controls { display: none; }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "vite": "https://aistudiocdn.com/vite@^7.2.6",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1"
  }
}
</script>
</head>
<body>
    <div id="sidebar">
        <div class="sidebar-content">
            <h2>Menu de Estudo</h2>
            <nav>
                <ul>
                    <li><a href="#" data-section="ae2" class="nav-link active"><span>üìö</span>Atividade 2 (AE2)</a></li>
                    <li><a href="#" data-section="ae3" class="nav-link"><span>üìö</span>Atividade 3 (AE3)</a></li>
                    <li class="has-submenu" id="livro-menu-item">
                        <a id="livro-toggle"><span>üìñ</span>Quest√µes (Livro) <i class="arrow"></i></a>
                        <ul class="submenu" id="livro-submenu">
                           <li><a href="#" data-section="livro-1" class="nav-link" title="Introdu√ß√£o e Princ√≠pios">Unidade 1 - Introdu√ß√£o</a></li>
                            <li><a href="#" data-section="livro-2" class="nav-link" title="Segmenta√ß√£o e 4Ps">Unidade 2 - Segmenta√ß√£o</a></li>
                            <li><a href="#" data-section="livro-3" class="nav-link" title="Pesquisa de Marketing">Unidade 3 - Pesquisa</a></li>
                            <li><a href="#" data-section="livro-4" class="nav-link" title="Planejamento e Controle">Unidade 4 - Planejamento</a></li>
                            <li><a href="#" data-section="livro-5" class="nav-link" title="An√°lise de Mercados">Unidade 5 - An√°lise</a></li>
                            <li><a href="#" data-section="livro-6" class="nav-link" title="Plano de Marketing">Unidade 6 - Plano Mkt</a></li>
                            <li><a href="#" data-section="livro-7" class="nav-link" title="Plano de Neg√≥cios">Unidade 7 - Plano Neg√≥cios</a></li>
                            <li><a href="#" data-section="livro-8" class="nav-link" title="Marketing Pessoal">Unidade 8 - Mkt Pessoal</a></li>
                            <li><a href="#" data-section="livro-9" class="nav-link" title="Atua√ß√£o do Nutricionista">Unidade 9 - Nutricionista</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="page-content">
        <div id="header-container">
             <div id="theme-switcher">
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div id="font-controls">
                <button id="font-decrease" title="Diminuir Fonte">A-</button>
                <button id="font-increase" title="Aumentar Fonte">A+</button>
            </div>
            <div id="counters-wrapper">
                <div id="score-counter" class="header-info-item"></div>
                <div id="incorrect-counter" class="header-info-item"></div>
                <div id="remaining-counter" class="header-info-item"></div>
            </div>
            <div id="progress-container">
                <div id="progress-bar"></div>
            </div>
        </div>
        <button id="menu-toggle">‚ò∞</button>
        
        <div id="resume-prompt" class="modal-overlay">
            <div class="modal-content">
                <h4>Sess√£o Encontrada!</h4>
                <p>Deseja continuar de onde parou?</p>
                <div class="modal-buttons">
                    <button id="resume-yes" class="quiz-button">Sim, continuar</button>
                    <button id="resume-no" class="quiz-button" style="background-color: var(--incorrect-color);">N√£o, come√ßar de novo</button>
                </div>
            </div>
        </div>

        <div class="main-content-wrapper">
            <h1>Quiz Marketing da Nutri√ß√£o</h1>
            <div id="final-score"></div>

            <section id="ae2" class="content-section active">
                <h3>Atividade de Estudo 2</h3>
                <div id="quiz-container-ae2"></div>
            </section>

            <section id="ae3" class="content-section">
                <h3>Atividade de Estudo 3</h3>
                <div id="quiz-container-ae3"></div>
            </section>
            
            <section id="livro-1" class="content-section"><h3>Unidade 1: Introdu√ß√£o e Princ√≠pios</h3><div id="quiz-container-livro-1"></div></section>
            <section id="livro-2" class="content-section"><h3>Unidade 2: Segmenta√ß√£o e 4Ps</h3><div id="quiz-container-livro-2"></div></section>
            <section id="livro-3" class="content-section"><h3>Unidade 3: Pesquisa de Marketing</h3><div id="quiz-container-livro-3"></div></section>
            <section id="livro-4" class="content-section"><h3>Unidade 4: Planejamento e Controle</h3><div id="quiz-container-livro-4"></div></section>
            <section id="livro-5" class="content-section"><h3>Unidade 5: An√°lise de Mercados</h3><div id="quiz-container-livro-5"></div></section>
            <section id="livro-6" class="content-section"><h3>Unidade 6: Plano de Marketing</h3><div id="quiz-container-livro-6"></div></section>
            <section id="livro-7" class="content-section"><h3>Unidade 7: Plano de Neg√≥cios</h3><div id="quiz-container-livro-7"></div></section>
            <section id="livro-8" class="content-section"><h3>Unidade 8: Marketing Pessoal</h3><div id="quiz-container-livro-8"></div></section>
            <section id="livro-9" class="content-section"><h3>Unidade 9: Atua√ß√£o do Nutricionista</h3><div id="quiz-container-livro-9"></div></section>
        </div>
    </div>

    <script>
        // --- QUIZ DATA (MARKETING DA NUTRI√á√ÉO) ---
        const allQuestions = {
            ae2: [
                {
                    question: "Uma empresa brasileira de alimentos saud√°veis deseja lan√ßar uma linha de snacks funcionais. A equipe decide aplicar segmenta√ß√£o comportamental. Assinale a alternativa que melhor representa a aplica√ß√£o correta dessa segmenta√ß√£o:",
                    options: ["Focar nos consumidores de alta renda, considerando que eles est√£o dispostos a pagar mais.", "Segmentar o mercado considerando caracter√≠sticas demogr√°ficas, como idade e g√™nero.", "Lan√ßar um √∫nico snack com todos os benef√≠cios poss√≠veis para atender a todos.", "Priorizar o lan√ßamento em supermercados de grande porte.", "Dividir o mercado em grupos com base nos benef√≠cios que cada grupo busca, criando produtos espec√≠ficos."],
                    correct: 4,
                    explanations: { correct: "A segmenta√ß√£o comportamental divide os compradores com base em seus conhecimentos, atitudes, usos ou respostas a um produto. A divis√£o por 'benef√≠cios buscados' √© uma forma cl√°ssica dessa segmenta√ß√£o (Kotler & Armstrong)." }
                },
                {
                    question: "Uma empresa de alimentos funcionais lan√ßa um snack proteico dos EUA no Brasil. Pesquisas mostram que brasileiros valorizam apelo natural e pre√ßo. Qual a estrat√©gia mais adequada?",
                    options: ["Ajustar o produto em termos de pre√ßo, sem modificar sabores.", "Focar na publicidade digital e redes sociais apenas.", "Manter exatamente o mesmo produto e comunica√ß√£o dos EUA.", "Investir em segmenta√ß√£o psicogr√°fica apenas.", "Realizar adapta√ß√£o do produto (sabores/por√ß√µes) √†s prefer√™ncias locais, mantendo o branding, mas ajustando ao comportamento brasileiro."],
                    correct: 4,
                    explanations: { correct: "A adapta√ß√£o do produto √© essencial quando se entra em mercados internacionais com culturas alimentares diferentes. O consumidor brasileiro tem prefer√™ncias espec√≠ficas (sabor, naturalidade) que diferem do mercado norte-americano." }
                },
                {
                    question: "Sobre os tipos de mercados (potencial, dispon√≠vel, alvo, atendido), analise as afirmativas:<br>I. Mercado dispon√≠vel refere-se ao segmento real onde a empresa vende.<br>II. Mercado atendido inclui consumidores com interesse e renda, mas limitados por leis.<br>III. Mercado potencial √© composto por todos com interesse e renda.<br>IV. Mercado-alvo √© o segmento espec√≠fico que a empresa escolhe focar.<br>√â correto o que se afirma em:",
                    options: ["I, apenas.", "II e IV, apenas.", "III e IV, apenas.", "I, II e III, apenas.", "I, II, III e IV."],
                    correct: 2,
                    explanations: { correct: "A afirmativa III define corretamente o mercado potencial e a IV o mercado-alvo. O mercado dispon√≠vel (I) s√£o os que t√™m interesse, renda e *acesso*. O mercado atendido (II) √© a parte do mercado qualificado que a empresa decide atacar." }
                },
                {
                    question: "Sobre Marketing Sensorial e de Experi√™ncia:<br>I. Marketing sensorial usa aromas, cores, etc.<br>II. Marketing de experi√™ncia busca intera√ß√µes memor√°veis.<br>III. Compartilham o objetivo de conex√£o emocional.<br>IV. Sensorial foca na viv√™ncia global, experi√™ncia em est√≠mulos espec√≠ficos.<br>√â correto o que se afirma em:",
                    options: ["I e IV, apenas.", "II e III, apenas.", "II e IV, apenas.", "I, II e III, apenas.", "II, III e IV, apenas."],
                    correct: 3,
                    explanations: { correct: "As afirmativas I, II e III est√£o corretas. A IV inverte ou confunde os conceitos: o marketing sensorial foca nos est√≠mulos (sentidos), enquanto o de experi√™ncia foca na viv√™ncia global e memor√°vel." }
                },
                {
                    question: "Sobre o impacto das cores no marketing sensorial de alimentos, assinale a correta:",
                    options: ["O amarelo √© associado √† alegria e energia, estimulando o apetite.", "O azul evoca fome intensa e urg√™ncia.", "O verde sugere artificialidade.", "O preto √© usado para transmitir baixo custo.", "O vermelho √© associado apenas a alimentos frios."],
                    correct: 0,
                    explanations: { correct: "Cores quentes como amarelo e vermelho s√£o conhecidas por estimular o apetite e evocar energia/alegria. O azul geralmente suprime o apetite ou √© associado a higiene/frio." }
                },
                {
                    question: "Qual tipo de pesquisa de marketing investiga evolu√ß√µes nas prefer√™ncias e usa an√°lise de m√≠dias sociais para detectar novos padr√µes (ex: gl√∫ten-free)?",
                    options: ["Pesquisas de comportamento de compra.", "Pesquisas de tend√™ncias de consumo.", "Pesquisas de produto.", "Pesquisas de segmenta√ß√£o.", "Pesquisas de prefer√™ncias do consumidor."],
                    correct: 1,
                    explanations: { correct: "A pesquisa de tend√™ncias de consumo foca em identificar padr√µes emergentes e mudan√ßas no comportamento ao longo do tempo, como a busca por produtos sem gl√∫ten ou √† base de plantas." }
                },
                {
                    question: "Sobre o conceito e papel do marketing:<br>I. Objetivo √© criar relacionamentos duradouros.<br>II. Produtos ajustados tornam a venda natural.<br>III. √â um processo social e administrativo de troca de valor.<br>IV. Foco √© apenas vender e lucrar a qualquer custo.<br>√â correto o que se afirma em:",
                    options: ["IV, apenas.", "I e IV, apenas.", "II e III, apenas.", "I, II e III, apenas.", "I, II, III e IV."],
                    correct: 3,
                    explanations: { correct: "As afirmativas I, II e III refletem a vis√£o moderna de marketing (Kotler). A IV est√° incorreta pois o marketing n√£o √© apenas vendas/propaganda, mas a cria√ß√£o de valor." }
                },
                {
                    question: "Uma cl√≠nica analisa estilo de vida, personalidade e valores para criar grupos de clientes. Qual segmenta√ß√£o √© essa?",
                    options: ["Geogr√°fica.", "Psicogr√°fica.", "Demogr√°fica.", "Por benef√≠cio.", "Comportamental."],
                    correct: 1,
                    explanations: { correct: "A segmenta√ß√£o psicogr√°fica divide os consumidores com base em classe social, estilo de vida ou caracter√≠sticas de personalidade." }
                },
                {
                    question: "Sobre a pesquisa de marketing:<br>I. Identifica oportunidades e nichos inexplorados.<br>PORQUE<br>II. √â uma ferramenta estrat√©gica que antecipa tend√™ncias e prev√™ demandas.<br>Assinale a op√ß√£o correta:",
                    options: ["As asser√ß√µes I e II s√£o verdadeiras, e a II √© uma justificativa correta da I.", "As asser√ß√µes I e II s√£o verdadeiras, mas a II n√£o √© uma justificativa correta da I.", "A asser√ß√£o I √© verdadeira e a II √© falsa.", "A asser√ß√£o I √© falsa e a II √© verdadeira.", "As asser√ß√µes I e II s√£o falsas."],
                    correct: 0,
                    explanations: { correct: "Ambas as asser√ß√µes s√£o verdadeiras. A pesquisa permite identificar nichos (I) justamente porque fornece dados para antecipar tend√™ncias e entender a demanda (II)." }
                },
                {
                    question: "Sobre necessidades, desejos e demandas:<br>'Um norte-americano quer um Big Mac, um habitante de Papua Nova Guin√© quer car√°'. Isso exemplifica:",
                    options: ["Desejos s√£o √∫nicos e biol√≥gicos.", "Marketing cria necessidades.", "Demanda independe de recursos.", "Necessidades fisiol√≥gicas b√°sicas podem se expressar em desejos diferentes conforme a cultura.", "Necessidades humanas s√£o criadas pelo marketing."],
                    correct: 3,
                    explanations: { correct: "A necessidade √© a priva√ß√£o b√°sica (fome). O desejo √© a forma que essa necessidade assume moldada pela cultura e personalidade." }
                }
            ],
            ae3: [
                {
                    question: "A empresa NatVax reuniu um pequeno grupo de consumidores em uma sala para discutir embalagens e compartilhar opini√µes em tempo real. Que tipo de pesquisa √© essa?",
                    options: ["Survey.", "Grupo focal (Focus Group).", "Entrevista em profundidade.", "Observa√ß√£o n√£o participante.", "Entrevistas semiestruturadas."],
                    correct: 1,
                    explanations: { correct: "O Grupo Focal consiste em reunir um pequeno grupo de pessoas para discutir um tema sob a media√ß√£o de um moderador, permitindo intera√ß√£o e feedback qualitativo." }
                },
                {
                    question: "Sobre as estrat√©gias competitivas de Porter (Lideran√ßa em Custos, Diferencia√ß√£o, Foco), analise:<br>I. Foco pode combinar custos ou diferencia√ß√£o em nicho restrito.<br>II. Lideran√ßa em custos visa maior participa√ß√£o via pre√ßos baixos.<br>III. Diferencia√ß√£o investe em desempenho superior/qualidade.<br>IV. Risco da diferencia√ß√£o √© surgimento de concorrentes com custos menores.<br>√â correto o que se afirma em:",
                    options: ["I e IV, apenas.", "II e III, apenas.", "II e IV, apenas.", "I, II e III, apenas.", "Todas as alternativas (I, II, III, IV)."],
                    correct: 4,
                    explanations: { correct: "Todas as afirmativas descrevem corretamente as estrat√©gias gen√©ricas de Michael Porter conforme a literatura de marketing." }
                },
                {
                    question: "Nutricionistas no cen√°rio digital:<br>I. Publicidade influencia escolhas (muitas vezes produtos n√£o saud√°veis).<br>PORQUE<br>II. Para contrabalan√ßar, nutricionistas devem usar dados cient√≠ficos e educar o p√∫blico.<br>Assinale a correta:",
                    options: ["As asser√ß√µes I e II s√£o verdadeiras, mas a II n√£o √© justificativa da I.", "A asser√ß√£o I √© falsa.", "As asser√ß√µes I e II s√£o verdadeiras, e a II √© uma justificativa (ou consequ√™ncia l√≥gica de a√ß√£o) da I.", "A asser√ß√£o I √© verdadeira e a II √© falsa.", "Ambas falsas."],
                    correct: 0,
                    explanations: { correct: "Ambas s√£o verdadeiras. A II √© a resposta √©tica ao problema apresentado na I, mas n√£o a 'causa' da I. A rela√ß√£o √© de problema-solu√ß√£o, n√£o causa-efeito direto no sentido estrito, mas no contexto da quest√£o, ambas s√£o verdadeiras e correlacionadas." }
                },
                {
                    question: "Sobre amostragem em pesquisa:<br>I. Estratificada √© para popula√ß√£o totalmente homog√™nea (Falso).<br>II. Amostragem permite generalizar conclus√µes.<br>III. Aleat√≥ria simples reduz vieses.<br>IV. Estratificada divide em grupos homog√™neos (estratos).<br>√â correto o que se afirma em:",
                    options: ["I e IV.", "II e III.", "III e IV.", "I, II e III.", "II, III e IV."],
                    correct: 4,
                    explanations: { correct: "A afirmativa I √© falsa. A amostragem estratificada √© usada quando a popula√ß√£o √© heterog√™nea e precisa ser dividida em subgrupos homog√™neos para garantir representatividade." }
                },
                {
                    question: "Sobre cultura e comportamento do consumidor:<br>I. Aceita√ß√£o do produto depende do alinhamento com valores culturais.<br>PORQUE<br>II. Fatores culturais s√£o influ√™ncias distantes e irrelevantes (Falso).<br>Assinale a correta:",
                    options: ["I e II verdadeiras.", "I verdadeira, II falsa.", "I falsa, II verdadeira.", "Ambas falsas.", "I e II verdadeiras, sem rela√ß√£o."],
                    correct: 1,
                    explanations: { correct: "A cultura √© uma influ√™ncia profunda e direta. A asser√ß√£o II √© falsa ao dizer que s√£o influ√™ncias distantes/irrelevantes ou que se limitam apenas a grupos pequenos; a cultura √© abrangente." }
                },
                {
                    question: "Teorias de marketing de alimentos:<br>I. Marketing nutricional foca na educa√ß√£o sobre nutrientes.<br>II. Marketing social, sensorial e nutricional ajudam escolhas conscientes.<br>III. Marketing sensorial usa 5 sentidos.<br>IV. Marketing social visa escolhas saud√°veis/sustent√°veis.<br>√â correto o que se afirma em:",
                    options: ["IV apenas.", "I e IV.", "II e III.", "I, II e III.", "I, II, III e IV."],
                    correct: 4,
                    explanations: { correct: "Todas as defini√ß√µes est√£o corretas e descrevem as vertentes do marketing aplicadas √† nutri√ß√£o." }
                },
                {
                    question: "Sobre o Plano de Marketing:<br>I. Plano t√°tico detalha a√ß√µes espec√≠ficas.<br>II. Plano t√°tico √© mais operacional.<br>III. Plano estrat√©gico inclui SWOT, segmenta√ß√£o, longo prazo.<br>IV. Plano estrat√©gico define vis√£o de longo prazo.<br>√â correto o que se afirma em:",
                    options: ["II apenas.", "I e IV.", "III e IV.", "I, II e III.", "I, II, III e IV."],
                    correct: 4,
                    explanations: { correct: "Todas as afirmativas distinguem corretamente o planejamento estrat√©gico (longo prazo, dire√ß√£o) do t√°tico (curto prazo, a√ß√µes espec√≠ficas, 4Ps)." }
                },
                {
                    question: "Neuromarketing:<br>I. Permite criar campanhas eficazes compreendendo respostas inconscientes.<br>PORQUE<br>II. Dispensa pesquisas tradicionais pois o c√©rebro √© mais preciso (Falso).<br>Assinale a correta:",
                    options: ["I e II verdadeiras.", "I e II verdadeiras, sem rela√ß√£o.", "I verdadeira, II falsa.", "I falsa, II verdadeira.", "Ambas falsas."],
                    correct: 2,
                    explanations: { correct: "A asser√ß√£o I √© verdadeira. A II √© falsa porque o neuromarketing n√£o dispensa as pesquisas tradicionais; ele as complementa." }
                },
                {
                    question: "Posicionamento do profissional:<br>I. Posicionamento deve ser consistente, √∫nico e imut√°vel (Falso - pode evoluir).<br>PORQUE<br>II. Objetivo √© criar identidade clara que ressoe com o p√∫blico.<br>Assinale a correta:",
                    options: ["I e II verdadeiras.", "I e II verdadeiras, sem rela√ß√£o.", "I verdadeira, II falsa.", "I falsa, II verdadeira.", "Ambas falsas."],
                    correct: 3,
                    explanations: { correct: "A asser√ß√£o I √© falsa pois o posicionamento n√£o √© imut√°vel; ele pode e deve ser ajustado conforme o mercado muda (reposicionamento). A II √© verdadeira." }
                },
                {
                    question: "Considere uma empresa lan√ßando snacks e aplicando os 4Cs (Cliente, Custo, Conveni√™ncia, Comunica√ß√£o). Analise:<br>I. Custo significa reduzir pre√ßo independente do valor (Falso).<br>II. Comunica√ß√£o deve enfatizar benef√≠cios e hist√≥rias.<br>III. Foco no cliente permite identificar prefer√™ncias.<br>IV. Conveni√™ncia inclui facilitar acesso e embalagens pr√°ticas.<br>√â correto o que se afirma em:",
                    options: ["I e IV.", "II e III.", "III e IV.", "I, II e III.", "II, III e IV."],
                    correct: 4,
                    explanations: { correct: "A afirmativa I √© falsa. Nos 4Cs, 'Custo' refere-se ao custo total para o cliente (incluindo tempo, esfor√ßo), n√£o apenas baixar o pre√ßo do produto." }
                }
            ],
            livro: [
                [ // Unidade 1
                    { question: "A ess√™ncia do marketing, segundo Kotler e Keller (2018), √©:", options: ["Vender a qualquer custo.", "Identificar e satisfazer necessidades.", "Criar produtos caros.", "Focar apenas na produ√ß√£o.", "Ignorar a concorr√™ncia."], correct: 1, explanations: { correct: "O marketing trata de identificar e satisfazer necessidades humanas e sociais de forma lucrativa." } },
                    { question: "Os 4Ps do Marketing s√£o:", options: ["Pessoas, Processos, Programas, Performance.", "Produto, Pre√ßo, Pra√ßa, Promo√ß√£o.", "Planejamento, Pesquisa, Produ√ß√£o, Publicidade.", "Poder, Pol√≠tica, Parceria, Paix√£o.", "Pre√ßo, Pra√ßa, Propaganda, P√∫blico."], correct: 1, explanations: { correct: "O mix de marketing cl√°ssico √© composto por Produto, Pre√ßo, Pra√ßa (Distribui√ß√£o) e Promo√ß√£o." } },
                    { question: "Qual das op√ß√µes N√ÉO √© uma aplica√ß√£o do marketing citada?", options: ["Bens e Servi√ßos.", "Eventos e Experi√™ncias.", "Pessoas e Lugares.", "Ideias e Informa√ß√µes.", "Impostos e Taxas."], correct: 4, explanations: { correct: "O marketing aplica-se a bens, servi√ßos, eventos, experi√™ncias, pessoas, lugares, propriedades, organiza√ß√µes, informa√ß√µes e ideias." } }
                ],
                [ // Unidade 2
                    { question: "A segmenta√ß√£o que divide o mercado com base em onde as pessoas vivem √©:", options: ["Demogr√°fica.", "Psicogr√°fica.", "Geogr√°fica.", "Comportamental.", "Socioecon√¥mica."], correct: 2, explanations: { correct: "A segmenta√ß√£o geogr√°fica divide o mercado em unidades geogr√°ficas como na√ß√µes, estados, regi√µes, cidades ou bairros." } },
                    { question: "A Gera√ß√£o Y, ou Millennials, √© caracterizada por:", options: ["Nascidos antes de 1945.", "Forte presen√ßa em m√≠dias sociais e ativismo.", "Prefer√™ncia por r√°dio.", "Avers√£o √† tecnologia.", "Foco exclusivo em pre√ßo."], correct: 1, explanations: { correct: "Os Millennials (1979-1994) s√£o marcados pela tecnologia, m√≠dias sociais e preocupa√ß√£o com causas sociais/ambientais." } },
                    { question: "A segmenta√ß√£o psicogr√°fica usa:", options: ["Idade e Renda.", "Pa√≠s e Cidade.", "Personalidade, estilo de vida e valores.", "Ocasi√£o de compra.", "Grau de fidelidade."], correct: 2, explanations: { correct: "A psicografia estuda o interior do consumidor: seus valores, estilo de vida e tra√ßos de personalidade." } }
                ],
                [ // Unidade 3
                    { question: "Qual t√©cnica de pesquisa envolve reunir um pequeno grupo para discuss√£o moderada?", options: ["Survey.", "Observa√ß√£o.", "Grupo Focal.", "Dados secund√°rios.", "Experimento."], correct: 2, explanations: { correct: "Grupos focais (focus groups) re√∫nem 6 a 10 pessoas para discutir um produto ou conceito sob a dire√ß√£o de um moderador." } },
                    { question: "Para que serve a 'Observa√ß√£o de Campo'?", options: ["Para tabular dados estat√≠sticos.", "Para observar como clientes interagem com produtos no ambiente real.", "Para criar logotipos.", "Para definir pre√ßos.", "Para contratar funcion√°rios."], correct: 1, explanations: { correct: "A pesquisa observacional coleta dados prim√°rios observando pessoas, a√ß√µes e situa√ß√µes relevantes no local." } },
                    { question: "Consumidores com 'Consci√™ncia Nutricional' tendem a:", options: ["Comprar o mais barato.", "Ignorar r√≥tulos.", "Buscar informa√ß√µes sobre nutrientes e benef√≠cios √† sa√∫de.", "Preferir fast-food.", "N√£o se importar com a origem do alimento."], correct: 2, explanations: { correct: "Consumidores conscientes buscam ativamente informa√ß√µes sobre a composi√ß√£o e benef√≠cios dos alimentos." } }
                ],
                [ // Unidade 4
                    { question: "Na an√°lise SWOT, 'For√ßas' e 'Fraquezas' s√£o fatores:", options: ["Externos.", "Internos.", "Futuros.", "Imposs√≠veis de medir.", "Irrelevantes."], correct: 1, explanations: { correct: "For√ßas e Fraquezas s√£o fatores internos (control√°veis) da empresa. Oportunidades e Amea√ßas s√£o externos." } },
                    { question: "A estrat√©gia de 'Lideran√ßa em Custos' de Porter visa:", options: ["Ter o produto mais caro.", "Produzir e distribuir a custos menores para ter pre√ßos competitivos.", "Focar em um nicho muito pequeno.", "Oferecer o produto mais luxuoso.", "Ignorar a concorr√™ncia."], correct: 1, explanations: { correct: "A lideran√ßa em custos busca efici√™ncia m√°xima para oferecer pre√ßos baixos e ganhar participa√ß√£o de mercado." } },
                    { question: "O que √© uma 'Alian√ßa Promocional'?", options: ["Fus√£o de empresas.", "Uma empresa promove o produto/servi√ßo de outra.", "Compra de concorrentes.", "Guerra de pre√ßos.", "Contrata√ß√£o de funcion√°rios."], correct: 1, explanations: { correct: "Exemplo: uma rede de fast-food promovendo brinquedos de um filme (est√∫dio de cinema) em seus lanches." } }
                ],
                [ // Unidade 5
                    { question: "O que comp√µe a 'Demanda de Mercado'?", options: ["Apenas o desejo de compra.", "Volume total de vendas em uma √°rea e per√≠odo espec√≠ficos.", "A produ√ß√£o total da f√°brica.", "O estoque da empresa.", "O n√∫mero de funcion√°rios."], correct: 1, explanations: { correct: "A demanda de mercado √© o volume total que seria comprado por um grupo definido, em uma √°rea geogr√°fica, em um per√≠odo de tempo." } },
                    { question: "O 'Mercado Dispon√≠vel' √©:", options: ["Quem tem interesse, renda e acesso.", "Quem j√° comprou.", "Quem n√£o gosta do produto.", "O mercado global.", "A concorr√™ncia."], correct: 0, explanations: { correct: "Mercado dispon√≠vel √© o conjunto de consumidores que possuem interesse, renda e acesso a uma oferta espec√≠fica." } },
                    { question: "Fatores Culturais no comportamento de compra incluem:", options: ["Idade e Renda.", "Motiva√ß√£o e Percep√ß√£o.", "Cultura, Subcultura e Classe Social.", "Fam√≠lia e Pap√©is.", "Pre√ßo e Produto."], correct: 2, explanations: { correct: "Cultura, subcultura e classe social s√£o as influ√™ncias culturais fundamentais no comportamento do consumidor." } }
                ],
                [ // Unidade 6
                    { question: "Qual se√ß√£o do plano de marketing apresenta uma vis√£o geral r√°pida?", options: ["An√°lise Financeira.", "Resumo Executivo.", "Estrat√©gia.", "T√°tica.", "An√°lise SWOT."], correct: 1, explanations: { correct: "O Resumo Executivo abre o plano de marketing apresentando um breve resumo das principais metas e recomenda√ß√µes." } },
                    { question: "A 'An√°lise da Situa√ß√£o' no plano de marketing inclui:", options: ["Dados hist√≥ricos, mercado, concorrentes e SWOT.", "Apenas o lucro desejado.", "A lista de funcion√°rios.", "O design do logotipo.", "O pre√ßo final."], correct: 0, explanations: { correct: "Essa se√ß√£o fornece o contexto necess√°rio, analisando o ambiente interno e externo antes de definir estrat√©gias." } },
                    { question: "O que s√£o 'Inova√ß√µes Cont√≠nuas'?", options: ["Produtos que criam novos mercados.", "Melhorias e revis√µes de produtos existentes.", "Produtos que falharam.", "C√≥pias exatas da concorr√™ncia.", "Produtos sem marca."], correct: 1, explanations: { correct: "A maioria das atividades de novos produtos dedica-se a melhorar produtos existentes (inova√ß√µes cont√≠nuas) em vez de inova√ß√µes radicais." } }
                ],
                [ // Unidade 7
                    { question: "A se√ß√£o 'Miss√£o' do plano de neg√≥cios define:", options: ["O lucro esperado.", "O prop√≥sito fundamental e a raz√£o de ser da empresa.", "O endere√ßo da empresa.", "O nome dos s√≥cios.", "A cor do logotipo."], correct: 1, explanations: { correct: "A miss√£o articula o prop√≥sito da organiza√ß√£o, seus valores e a dire√ß√£o que deseja seguir." } },
                    { question: "Para uma empresa de alimentos gourmet, a an√°lise de 'Concorrentes' deve:", options: ["Ignorar outras marcas.", "Identificar marcas premium similares e seus pontos fortes/fracos.", "Focar apenas em fast-food.", "Copiar tudo que eles fazem.", "N√£o √© necess√°ria."], correct: 1, explanations: { correct: "Conhecer a concorr√™ncia (direta e indireta) √© vital para posicionar a empresa e destacar suas vantagens competitivas." } },
                    { question: "A se√ß√£o de 'Viabilidade' serve para:", options: ["Encher o documento.", "Avaliar se a ideia √© pr√°tica e tem potencial de sucesso financeiro/operacional.", "Escolher o nome da empresa.", "Contratar o marketing.", "Definir o uniforme."], correct: 1, explanations: { correct: "A an√°lise de viabilidade √© a conclus√£o l√≥gica que demonstra se o neg√≥cio deve ou n√£o ser implementado com base nos dados." } }
                ],
                [ // Unidade 8
                    { question: "O Marketing Pessoal foca em:", options: ["Vender produtos.", "Promover a imagem e qualidades do indiv√≠duo no mercado.", "Criar logotipos empresariais.", "Gerenciar estoques.", "An√°lise financeira."], correct: 1, explanations: { correct: "Marketing pessoal √© a aplica√ß√£o de ferramentas de marketing para promover o profissional, suas habilidades e imagem." } },
                    { question: "Em uma entrevista, o que √© fundamental al√©m da qualifica√ß√£o t√©cnica?", options: ["Chegar atrasado.", "Postura, imagem pessoal e comunica√ß√£o eficaz.", "Falar g√≠rias.", "Ignorar a cultura da empresa.", "N√£o fazer perguntas."], correct: 1, explanations: { correct: "A imagem, a comunica√ß√£o n√£o-verbal e o alinhamento cultural s√£o decisivos na percep√ß√£o do entrevistador." } },
                    { question: "Networking no marketing pessoal significa:", options: ["Vender produtos para amigos.", "Construir e cultivar uma rede de contatos profissionais.", "Passar o dia nas redes sociais.", "Pedir emprego para desconhecidos.", "Evitar eventos da √°rea."], correct: 1, explanations: { correct: "Networking √© a constru√ß√£o de relacionamentos genu√≠nos que podem gerar oportunidades e troca de conhecimentos." } }
                ],
                [ // Unidade 9
                    { question: "O nutricionista no marketing de alimentos pode:", options: ["Promover produtos sem comprova√ß√£o cient√≠fica.", "Garantir que r√≥tulos e alega√ß√µes sejam precisos, claros e √©ticos.", "Ignorar as leis da ANVISA.", "Receber comiss√£o por vendas casadas.", "Fazer propaganda enganosa."], correct: 1, explanations: { correct: "O papel √©tico do nutricionista √© assegurar a veracidade e o car√°ter educativo das informa√ß√µes nutricionais." } },
                    { question: "Sobre o C√≥digo de √âtica e divulga√ß√£o:", options: ["√â permitido usar imagens de pacientes ('antes e depois') para autopromo√ß√£o.", "√â proibido garantir resultados exclusivos ou sensacionalistas.", "Pode-se prescrever marca √∫nica.", "O valor da consulta deve ser usado como propaganda.", "N√£o h√° regras."], correct: 1, explanations: { correct: "O C√≥digo de √âtica pro√≠be sensacionalismo, garantia de resultados (pois variam biologicamente) e uso indevido de imagem." } },
                    { question: "No equil√≠brio de interesses (comercial vs sa√∫de), o nutricionista deve:", options: ["Priorizar sempre o lucro da empresa.", "Atuar com integridade, defendendo a sa√∫de p√∫blica e a sustentabilidade.", "Sair do mercado.", "Ignorar a ci√™ncia.", "Seguir apenas o que o marketing pede."], correct: 1, explanations: { correct: "O desafio √©tico √© conciliar o trabalho na ind√∫stria com a responsabilidade de promover a sa√∫de e a sustentabilidade." } }
                ]
            ]
        };
        
        // --- GLOBAL APP STATE ---
        let state = { correctAnswers: 0, incorrectAnswers: 0, answeredQuestions: 0, selectedAnswers: {}, incorrectlyAnswered: {}, timerSeconds: 0 };
        let timerInterval;
        let totalQuestions = 0;
        
        // --- CORE FUNCTIONS ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeQuiz();
            setupEventListeners();
        });

        function initializeQuiz() {
            totalQuestions = Object.values(allQuestions).flat(2).length;
            
            const savedState = localStorage.getItem('quizMarketingState');
            if (savedState) {
                document.getElementById('resume-prompt').classList.add('visible');
            } else {
                startNewQuiz();
            }
            const savedTheme = localStorage.getItem('quizTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('dark-mode-toggle').checked = true;
            }
        }

        function startNewQuiz() {
            resetState();
            localStorage.removeItem('quizMarketingState');
            loadAllQuestions();
            updateCountersAndProgress();
            startTimer();
            document.getElementById('final-score').style.display = 'none';
        }

        function resumeQuiz() {
            const savedState = JSON.parse(localStorage.getItem('quizMarketingState'));
            if (savedState) {
                state = savedState;
                loadAllQuestions();
                restoreUIState();
                updateCountersAndProgress();
                startTimer(state.timerSeconds);
            }
        }
        
        function resetState() {
            state = { correctAnswers: 0, incorrectAnswers: 0, answeredQuestions: 0, selectedAnswers: {}, incorrectlyAnswered: {}, timerSeconds: 0 };
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => link.addEventListener('click', (e) => handleNavClick(e, link)));
            document.getElementById('livro-toggle').addEventListener('click', function(e){ e.preventDefault(); document.getElementById('livro-submenu').classList.toggle('open'); document.getElementById('livro-menu-item').classList.toggle('open'); });
            document.getElementById('menu-toggle').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('open'));
            document.getElementById('font-increase').addEventListener('click', () => changeFontSize(1));
            document.getElementById('font-decrease').addEventListener('click', () => changeFontSize(-1));
            document.getElementById('dark-mode-toggle').addEventListener('change', toggleTheme);
            document.getElementById('resume-yes').addEventListener('click', () => { document.getElementById('resume-prompt').classList.remove('visible'); resumeQuiz(); });
            document.getElementById('resume-no').addEventListener('click', () => { document.getElementById('resume-prompt').classList.remove('visible'); startNewQuiz(); });
        }

        function handleNavClick(e, link) {
            e.preventDefault();
            const sectionId = link.getAttribute('data-section');
            if (!sectionId) return;

            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            if (link.closest('.submenu')) {
                document.getElementById('livro-toggle').classList.add('active');
            } else if (link.id !== 'livro-toggle') {
                 document.getElementById('livro-toggle').classList.remove('active');
            }

            document.querySelectorAll('.content-section').forEach(section => section.classList.toggle('active', section.id === sectionId));
            
            if (window.innerWidth <= 1024) {
                document.getElementById('sidebar').classList.remove('open');
            }
            
            document.querySelector('.page-content').scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function loadAllQuestions() {
            for (const category in allQuestions) {
                if (category === 'livro') {
                    allQuestions.livro.forEach((unit, index) => {
                        const unitId = index + 1;
                        const containerId = `quiz-container-livro-${unitId}`;
                        const container = document.getElementById(containerId);
                        if(container) {
                             container.innerHTML = generateQuestionHTML(unit, `livro-${unitId}`);
                        }
                    });
                } else {
                    const containerId = `quiz-container-${category}`;
                    const container = document.getElementById(containerId);
                    if (container) {
                         container.innerHTML = generateQuestionHTML(allQuestions[category], category);
                    }
                }
            }
        }

        function generateQuestionHTML(questions, prefix) {
            return questions.map((q, i) => {
                const qId = `${prefix}-${i}`;
                return `
                <div class="question-container" id="question-${qId}">
                    <div class="question"><strong>${i + 1}¬™ Quest√£o</strong><br>${q.question}</div>
                    <div class="options">
                        ${q.options.map((opt, optIdx) => `
                            <label>
                                <input type="radio" name="answer-${qId}" value="${optIdx}" onchange="selectAnswer('${qId}')">
                                <span>${opt}</span>
                            </label>`).join('')}
                    </div>
                    <button id="submit-btn-${qId}" class="quiz-button" onclick="checkAnswer('${qId}')" disabled>Verificar Resposta</button>
                    <div class="feedback" id="feedback-${qId}" style="display: none;"></div>
                </div>`;
            }).join('');
        }
        
        function selectAnswer(questionId) {
            const radio = document.querySelector(`input[name="answer-${questionId}"]:checked`);
            if (radio) {
                state.selectedAnswers[questionId] = parseInt(radio.value, 10);
                document.getElementById(`submit-btn-${questionId}`).disabled = false;
            }
        }
        
        function checkAnswer(questionId) {
            const parts = questionId.split('-');
            const prefix = parts[0];
            let questionData;

            // Handle data retrieval based on prefix (ae2, ae3, or livro)
            if (prefix === 'ae2' || prefix === 'ae3') {
                questionData = allQuestions[prefix][parseInt(parts[1], 10)];
            } else if (prefix === 'livro') {
                // Format: livro-{unit}-{questionIndex}
                const unitIndex = parseInt(parts[1], 10) - 1;
                const questionIndex = parseInt(parts[2], 10);
                questionData = allQuestions.livro[unitIndex][questionIndex];
            }
            if (!questionData) return;

            const userAnswer = state.selectedAnswers[questionId];
            if (userAnswer === undefined) return;

            const isCorrect = userAnswer === questionData.correct;
            
            const feedbackDiv = document.getElementById(`feedback-${questionId}`);
            if (!feedbackDiv.hasAttribute('data-answered')) {
                 state.answeredQuestions++;
                 if (isCorrect) state.correctAnswers++;
                 else {
                    state.incorrectAnswers++;
                    state.incorrectlyAnswered[questionId] = {
                        text: questionData.question,
                        sectionId: `question-${questionId}`
                    };
                 }
                feedbackDiv.setAttribute('data-answered', 'true');
            }

            renderFeedback(feedbackDiv, isCorrect, questionData, userAnswer);
            updateCountersAndProgress();
            disableQuestion(questionId, questionData, userAnswer);

            localStorage.setItem('quizMarketingState', JSON.stringify(state));

            if (state.answeredQuestions === totalQuestions) {
                renderFinalScore();
            }
        }

        // --- UI & State Restoration ---
        function restoreUIState() {
            for (const questionId in state.selectedAnswers) {
                if (Object.hasOwnProperty.call(state.selectedAnswers, questionId)) {
                    const userAnswer = state.selectedAnswers[questionId];
                    const parts = questionId.split('-');
                    const prefix = parts[0];
                    let questionData;
                    
                    if (prefix === 'ae2' || prefix === 'ae3') {
                        questionData = allQuestions[prefix][parseInt(parts[1], 10)];
                    } else if (prefix === 'livro') {
                        const unitIndex = parseInt(parts[1], 10) - 1;
                        const questionIndex = parseInt(parts[2], 10);
                        questionData = allQuestions.livro[unitIndex][questionIndex];
                    }

                    if(questionData) {
                        const feedbackDiv = document.getElementById(`feedback-${questionId}`);
                        if(feedbackDiv) {
                            feedbackDiv.setAttribute('data-answered', 'true');
                            renderFeedback(feedbackDiv, userAnswer === questionData.correct, questionData, userAnswer);
                            disableQuestion(questionId, questionData, userAnswer);
                        }
                    }
                }
            }
            if (state.answeredQuestions === totalQuestions) {
                renderFinalScore();
            }
        }

        function renderFeedback(feedbackDiv, isCorrect, questionData, userAnswer) {
            let feedbackHTML = '';
            if (isCorrect) {
                feedbackHTML = `<p class="correct-feedback"><strong>Correto!</strong> ${questionData.explanations.correct}</p>`;
                feedbackDiv.style.borderLeftColor = "var(--correct-color)";
            } else {
                feedbackHTML = `<p class="incorrect-feedback"><strong>Incorreto.</strong></p><p>${questionData.explanations.correct}</p>`;
                feedbackDiv.style.borderLeftColor = "var(--incorrect-color)";
            }
            feedbackDiv.innerHTML = feedbackHTML;
            feedbackDiv.style.display = 'block';
        }

        function disableQuestion(questionId, questionData, userAnswer) {
            const container = document.getElementById(`question-${questionId}`);
            if(!container) return;
            const labels = container.querySelectorAll('.options label');
            labels.forEach((label, i) => {
                const radio = label.querySelector('input');
                if (i === questionData.correct) label.classList.add('correct');
                else if (i === userAnswer) label.classList.add('incorrect');
                if (i === userAnswer) radio.checked = true;
                radio.disabled = true;
            });
            document.getElementById(`submit-btn-${questionId}`).style.display = 'none';
        }

        function renderFinalScore() {
            const scoreDiv = document.getElementById('final-score');
            let reviewHTML = '';
            if(Object.keys(state.incorrectlyAnswered).length > 0) {
                reviewHTML = '<div id="incorrect-review-list"><h4>Revise as quest√µes que voc√™ errou:</h4>';
                for(const qId in state.incorrectlyAnswered) {
                    const qInfo = state.incorrectlyAnswered[qId];
                    const questionNumber = parseInt(qId.split('-').pop(), 10) + 1;
                    reviewHTML += `<a href="#${qInfo.sectionId}">- Quest√£o ${questionNumber}: ${qInfo.text.substring(0, 50)}...</a>`;
                }
                reviewHTML += '</div>';
            }
            scoreDiv.innerHTML = `üéâ Quiz finalizado! Voc√™ acertou <span>${state.correctAnswers} de ${totalQuestions}</span> quest√µes. üéâ${reviewHTML}<button id="reset-quiz-btn" class="quiz-button">Refazer o Quiz</button>`;
            scoreDiv.style.display = 'block';
            document.getElementById('reset-quiz-btn').addEventListener('click', startNewQuiz);
        }

        // --- UTILITY FUNCTIONS ---
        function updateCounters() {
            document.getElementById('score-counter').innerHTML = `‚úÖ Acertos: ${state.correctAnswers}`;
            document.getElementById('incorrect-counter').innerHTML = `‚ùå Erradas: ${state.incorrectAnswers}`;
            document.getElementById('remaining-counter').innerHTML = `‚è≥ Faltam: ${totalQuestions - state.answeredQuestions}`;
        }
        
        function updateProgressBar() {
            const percentage = totalQuestions > 0 ? (state.answeredQuestions / totalQuestions) * 100 : 0;
            document.getElementById('progress-bar').style.width = `${percentage}%`;
        }
        
        function updateCountersAndProgress() {
            updateCounters();
            updateProgressBar();
        }

        function startTimer(startSeconds = 0) {
            if(timerInterval) clearInterval(timerInterval);
            state.timerSeconds = startSeconds;
            // No visible timer display in header in original design, but logic kept for state
            timerInterval = setInterval(() => {
                state.timerSeconds++;
            }, 1000);
        }

        let currentFontSize = 16;
        function changeFontSize(amount) {
            const minSize = 12;
            const maxSize = 20;
            const newSize = currentFontSize + amount;
            if (newSize >= minSize && newSize <= maxSize) {
                currentFontSize = newSize;
                document.documentElement.style.fontSize = `${currentFontSize}px`;
            }
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            localStorage.setItem('quizTheme', theme);
        }

        document.getElementById('mobile-menu-button')?.addEventListener('click', function() {
            var menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });
    </script>
</body>
</html>
